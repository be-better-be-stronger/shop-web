<div class="container py-3" style="max-width: 960px;">
  <h4 class="mb-3">
    {{ productId ? 'Edit Product' : 'Create Product' }}
  </h4>

  @if (msg) {
    <div class="alert alert-success">{{ msg }}</div>
  }

  @if (err) {
    <div class="alert alert-danger">{{ err }}</div>
  }

  <div class="row g-3">
    <!-- IMAGE -->
    <div class="col-12 col-lg-4">
      <div class="card">
        <div class="card-header">Image</div>
        <div class="card-body">

          @if (previewUrl()) {
            <img [src]="previewUrl()" class="img-fluid rounded mb-2" />
          } @else {
            <div class="border bg-light d-flex align-items-center justify-content-center mb-2"
                 style="height: 240px;">
              <span class="text-muted small">No image</span>
            </div>
          }

          <input type="file"
                 class="form-control"
                 accept="image/jpeg,image/png,image/webp"
                 (change)="onPickImage($event)">

          <div class="small mt-2">
            @if (uploading()) {
              <span class="text-muted">Uploading...</span>
            } @else if (imageUrl) {
              <span class="text-success">Uploaded</span>
            }
          </div>

        </div>
      </div>
    </div>

    <!-- FORM -->
    <div class="col-12 col-lg-8">
      <form [formGroup]="form" (ngSubmit)="submit()" novalidate>

        <!-- NAME -->
        <div class="mb-3">
          <label class="form-label">Name *</label>
          <input
            class="form-control"
            formControlName="name"
            [class.is-invalid]="form.controls.name.touched && form.controls.name.invalid">

          @if (form.controls.name.touched && form.controls.name.hasError('required')) {
            <div class="invalid-feedback">Name is required</div>
          }
          @if (form.controls.name.touched && form.controls.name.hasError('maxlength')) {
            <div class="invalid-feedback">Max 100 characters</div>
          }
        </div>

        <!-- DESCRIPTION -->
        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea
            rows="3"
            class="form-control"
            formControlName="description"
            [class.is-invalid]="form.controls.description.touched && form.controls.description.invalid"></textarea>

          @if (form.controls.description.touched
                && form.controls.description.hasError('maxlength')) {
            <div class="invalid-feedback">Max 500 characters</div>
          }
        </div>

        <div class="row g-3">
          <!-- STOCK -->
          <div class="col-md-6">
            <label class="form-label">Stock *</label>
            <input
              type="number"
              class="form-control"
              formControlName="stock"
              [class.is-invalid]="form.controls.stock.touched && form.controls.stock.invalid">

            @if (form.controls.stock.touched && form.controls.stock.hasError('required')) {
              <div class="invalid-feedback">Stock is required</div>
            }
            @if (form.controls.stock.touched && form.controls.stock.hasError('min')) {
              <div class="invalid-feedback">Must be â‰¥ 1</div>
            }
          </div>

          <!-- PRICE -->
          <div class="col-md-6">
            <label class="form-label">Price *</label>
            <input
              type="number"
              step="0.01"
              class="form-control"
              formControlName="price"
              [class.is-invalid]="form.controls.price.touched && form.controls.price.invalid">

            @if (form.controls.price.touched && form.controls.price.hasError('required')) {
              <div class="invalid-feedback">Price is required</div>
            }
            @if (form.controls.price.touched && form.controls.price.hasError('min')) {
              <div class="invalid-feedback">Price must be > 0</div>
            }
          </div>
        </div>

        <!-- CATEGORY -->
        <div class="mb-3 mt-3">
          <label class="form-label">Category *</label>
          <select
            class="form-select"
            formControlName="categoryId"
            [class.is-invalid]="form.controls.categoryId.touched && form.controls.categoryId.invalid">

            @for (c of categories; track c.id) {
              <option [value]="c.id">{{ c.name }}</option>
            }
          </select>

          @if (form.controls.categoryId.touched
                && form.controls.categoryId.hasError('required')) {
            <div class="invalid-feedback">Category is required</div>
          }
        </div>

        <!-- ACTIVE -->
        <div class="form-check form-switch mb-3">
          <input class="form-check-input"
                 type="checkbox"
                 id="isActive"
                 formControlName="isActive">
          <label class="form-check-label" for="isActive">
            Active
          </label>
        </div>

        <!-- ACTIONS -->
        <div class="d-flex gap-2">
          <button class="btn btn-primary"
                  type="submit"
                  [disabled]="saving() || uploading()">
            {{ productId ? 'Update' : 'Create' }}
          </button>

          @if (productId) {
            <button type="button"
                    class="btn btn-outline-danger"
                    (click)="disable()"
                    [disabled]="saving()">
              Disable
            </button>
          }
        </div>

      </form>
    </div>
  </div>
</div>
